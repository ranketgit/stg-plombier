---
import Layout from "../layouts/Layout.astro"; 
import Hero from "../components/homepage/Hero.astro"; 
import { data } from "../data/locations";
import CityServices from '../components/city/CityServices.astro';
import CityQuartiers from '../components/city/CityQuartiers.astro';
import CityUrgence from '../components/city/CityUrgence.astro';
import CityAvantages from '../components/city/CityAvantages.astro';
import CityProblems from '../components/city/CityProblems.astro';
import CityTestimonials from '../components/city/CityTestimonials.astro';
import CityFAQ from '../components/city/CityFAQ.astro';
import CityTips from '../components/city/CityTips.astro';
import CityEnvirons from '../components/city/CityEnvirons.astro';
import CityTarifs from '../components/city/CityTarifs.astro';
import CityConclusion from '../components/city/CityConclusion.astro';
import { generateSchema } from "../seo/schema";

export function getStaticPaths() {
    const paths = [];
    data.forEach(stateObject => {
        if (stateObject.Cities && Array.isArray(stateObject.Cities)) {
            stateObject.Cities.forEach(cityObject => {
                if (cityObject.slug && cityObject.cityName) {
                    paths.push({
                        params: { city: cityObject.slug },
                        props: {
                            cityName: cityObject.cityName,
                            citySlug: cityObject.slug, // ADD citySlug HERE (necessary for CityEnvirons)
                            stateName: stateObject.State,
                            sections: cityObject.sections && Array.isArray(cityObject.sections) 
                                ? cityObject.sections.map(s => ({ name: s.name, slug: s.slug, codePostal: s.codePostal })) 
                                : [] 
                        }
                    });
                }
            });
        }
    });
    return paths;
}

const { cityName, citySlug, stateName, sections } = Astro.props;
const heroData = {
  title: `Plombier ${cityName} - Dépannage d'Urgence et Services Professionnels`,
  subtitle: `Besoin d'un plombier à ${cityName}? Notre équipe intervient rapidement dans tout ${cityName} et ses environs pour résoudre efficacement vos problèmes de plomberie. Disponibles 24/7.`,
  phoneNumber: "+32476232323",
  callButtonText: "0476/23.23.23",
  serviceButtonText: "Nos Services à " + cityName,
  backgroundImageUrl: "/plombier-professionnel-belgique.webp",
};


const meta_title = `Plombier ${cityName} en urgence ⭐️ 24/7`;
const meta_description = `Plombier professionnel et agréé à ${cityName} ⭐️ détection et réparation de fuite d'eau, installation sanitaire. Intervention urgente 24/7 ☎️ 0476/23.23.23.`;
const schemaMarkup = generateSchema(meta_title, meta_description, 31);
---

<Layout meta_title={meta_title} meta_description={meta_description} schemaMarkup={schemaMarkup}>
    <Hero heroData={heroData} />
    <CityServices cityName={cityName} 
    cardBackgroundImages={[
        '/debouchage-de-canalisation.webp',
        '/installation-sanitaire.webp',
        '/service-chaufagiste.webp',
        '/reparation-fuite-eau.webp',
      ]}
    />
    <CityQuartiers cityName={cityName} imageUrl="/plombier-pro-belgique-assur-plombier.webp" /> 
    <CityUrgence cityName={cityName} />
    <CityAvantages cityName={cityName} />
    <CityProblems cityName={cityName} />
    <CityTestimonials cityName={cityName} />
    <CityFAQ cityName={cityName} />
    <CityTips cityName={cityName} />
    <CityEnvirons cityName={cityName} citySlug={citySlug} sections={sections} />     
    <CityTarifs cityName={cityName} />
    <CityConclusion cityName={cityName} />
</Layout>