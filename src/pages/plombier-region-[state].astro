---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/homepage/Hero.astro";
import { data, slugify } from "../data/locations";
import Services from "../components/region/Services.astro";
import WhyChooseUs from "../components/region/WhyChooseUs.astro";
import Interventions from "../components/region/Interventions.astro";
import Testimonials from '../components/region/Testimonials.astro';
import FAQ from '../components/region/FAQ.astro';
import CommonProblems from '../components/region/CommonProblems.astro';
import Tips from '../components/region/Tips.astro';
import Conclusion from '../components/region/Conclusion.astro';

export function getStaticPaths() {
    return data.map(stateObject => {
        
        let citiesForState = [];
        if (stateObject.Cities && Array.isArray(stateObject.Cities)) {
            citiesForState = stateObject.Cities.map(city => {
                // We expect city.cityName and city.slug to be present based on your data
                return { name: city.cityName, slug: city.slug };
            }).filter(city => city.name && city.slug); // Ensure valid city objects
        }

        return {
            params: { 
                // Reverted to use slugify on the State name for the path parameter
                // This was the likely original behavior for generating the state page URL
                state: slugify(stateObject.State) 
            },
            props: { 
                state: stateObject.State, // The actual state name, e.g., "Bruxelles Capitale"
                // Pass the array of city objects (name and slug)
                cities: citiesForState
            } 
        };
    });
}

const {state, cities} = Astro.props; // 'state' is the actual name, 'cities' is [{name, slug}, ...]

const heroData = {
  title: `Plombier Professionnel à ${state} - Intervention Rapide 24h/24`,
  subtitle: `Besoin d'un plombier qualifié à ${state} ? Notre équipe de plombiers professionnels intervient rapidement dans toute la région ${state} pour résoudre tous vos problèmes de plomberie. Disponibles 24h/24 et 7j/7, nous vous garantissons une intervention dans l'heure en cas d'urgence pour tout débouchage de canalisation, réparation de fuite d'eau ou panne de chauffage.`,
  phoneNumber: "+32472808080",
  callButtonText: "0476/23.23.23",
  serviceButtonText: "Nos Services",
  backgroundImageUrl: "/plombier-professionnel-belgique.jpg",
};

const seoData = {
    title: `Plombier ${state} en urgence - Plomberie et débouchage 24/7`,
    description: `Plombier et deboucheur professionnel ⭐️ disponible 24/7 à ${state}. Intervention rapide, devis gratuit. Expert en débouchage canalisation. ☎️ 0476/23.23.23`,
    schema: "",
}
---

<Layout SeoData={seoData} location={state}>
    <Hero heroData={heroData} />
    <Services state={state} />
    <WhyChooseUs state={state} />
    <Interventions state={state} cities={cities}/> {/* cities now contains { name, slug } for each city */}
    <Testimonials state={state} />
    <FAQ state={state} />
    <CommonProblems state={state} />
    <Tips state={state} />
    <Conclusion state={state}/>
</Layout>